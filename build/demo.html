<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb" dir="ltr">
<head>
	<title>demo 3d cave viewer</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link type="text/css" href="CaveView/css/caveview.css" rel="stylesheet"/>
	<style>

		h1, h2 {
			margin-left: 50px;
		}

		div#scene {
			position: relative;
			width: 600px;
			height:600px;
			margin-left: 100px;	
		}

		div#scene-caption {
			position: absolute;
			top: 8px;
			left: 100px;
			color: white;
			background-color: black;
		}

	</style>
</head>
<body onload="onload();" >
<script type="text/javascript" src="CaveView/lib/three.js" ></script>
<script type="text/javascript" src="CaveView/lib/OrbitControls.js" ></script>
<script type="text/javascript" src="CaveView/js/CaveView.js" ></script>
<script type="text/javascript" >
"use strict";

var	caveLoader = new CV.Loader( caveLoaded, progress );
var	viewState;
var viewControls;
var captionDiv;
var cave;
var index = 0;

var demo = [

	{
		caption: "3D Cave survey",
		delay: 5,
		view: {
			zScale: 0.5
		}
	},
	
	{
		caption: "3D Cave survey",
		delay: 7,
		view: {
			view: CV.VIEW_ELEVATION_S
		},
	},
	{
		caption: "Displays passage walls ...",
		delay: 2,
		view: {
			walls: true
		}
	},
	{
		caption: "...",
		delay: 2,
		controls: {
			autoRotate: true,
			autoRotateRate: 2.0
		}
	},
	{
		caption: "Supports multiple cave shading modes ...",
		delay: 5,
		view: {
			shadingMode: CV.SHADING_SINGLE
		}
	},

	{
		caption: "... shading by height ...",
		delay: 5,
		view: {
			shadingMode: CV.SHADING_HEIGHT
		}
	},

	{
		caption: "... shading by leg length ...",
		delay: 5,
		view: {
			shadingMode: CV.SHADING_LENGTH
		}
	},
	{
		caption: "... shading by leg inclination ...",
		delay: 5,
		view: {
			shadingMode : CV.SHADING_INCLINATION
		}
	},
	{
		caption: "... shading by survey section ...",
		delay: 5,
		view: {
			shadingMode: CV.SHADING_SURVEY
		}
	},
	{
		caption: " and shading by depth below surface.",
		delay: 5,
		view: {
			shadingMode: CV.SHADING_DEPTH
		}
	},
	{
		caption: "Entrance Markers",
		delay: 5,
		view: {
			entrances: true
		}
	},
	{
		caption: "Terrain (tiled at multiple resolutions)",
		delay: 5,
		view: {
			terrainOpacity: 1,
			terrain: true,
			view: CV.VIEW_PLAN
		}
	},

	{
		caption: "Adjustable terrain transparency",
		delay: 5,
		view: {
			terrainOpacity: 0.4,
			view: CV.VIEW_ELEVATION_S
		}
	},
	{
		caption: "On screen indicators",
		delay: 5,
		view: {
			HUD: true
		}
	},
	{
		caption: "Optional bounding box",
		delay: 5,
		view: {
			box: true,
		}
	},
	{
		caption: "Vertical scaling ( x2 )",
		delay: 5,
		view: {
			zScale: 0.75
		}
	},
	{
		caption: "Vertical scaling ( x4 )",
		delay: 5,
		view: {
			zScale: 1.0,
			terrainOpacity: 1,
			terrain: false
		}
	},
	{
		caption: "Focus on selected survey sections",
		delay: 5,
		view: {
			zScale: 0.5,
			section: 3,
			box: false
		}
	},
	{
		caption: "Orthographic view",
		delay: 5,
		view: {
			section: 3,
			cameraType: CV.CAMERA_ORTHOGRAPHIC,
			view: CV.VIEW_ELEVATION_S
		}
	},
	{
		caption: "...",
		delay: 5,
		view: {
			section: 0,
			entrances: false,
			cameraType: CV.CAMERA_PERSPECTIVE,
			view: CV.VIEW_PLAN,
			box: false,
			shadingMode: CV.SHADING_SINGLE,
			walls: false,
			HUD: false
		},
		controls: {
			autoRotate: false
		}
	},
];


function runDemo() {

	if ( index === demo.length ) index = 0;

	var d = demo[index++];
	var p;

	captionDiv.textContent = d.caption;

	var view     = d.view;
	var controls = d.controls;

	if ( view ) {

		for ( p in view ) viewState[p] = view[p];

	}

	if ( controls ) for ( p in controls ) viewControls[p] = controls[p];

	setTimeout(runDemo, d.delay * 1000 ); // FIXME * 1000 for real time spec

}

function progress ( pcent ) {}

function caveLoaded ( newCave ) {

	cave = newCave;

	viewState = CV.Viewer.getState;
	viewState.addEventListener( "newCave", viewComplete );

	CV.Viewer.loadCave( cave );

}

function viewComplete () {

	// display shading mode and initialize

	viewState.shadingMode = CV.SHADING_SINGLE;

	viewState.entrances  = false;
	viewState.box        = false;
	viewState.HUD        = false;
	viewState.walls      = false;

	// drop reference to cave to free heap space
	cave = null;

	viewControls = CV.Viewer.getControls();

	runDemo();
}

function onload () {

	CV.Viewer.init( "scene" );
	CV.Hud.init( "scene" );

	CV.Viewer.clearView();

	caveLoader.loadURL( "/surveys/P8_Master.3d" );
	
	captionDiv = document.getElementById( "scene-caption" );

}

</script>
<h1>Cave View</h1>
<h2>a 3D Cave Survey Viewer for the web.</h2>
<div id="scene" ><div id="scene-caption" ></div></div>
<div id="scene-caption" ></div>
<p>Mouse: left button down - rotate, right button down pan, mouse wheel - zoom</p>
<p>contains DTM data &copy; Environment Agency copyright and/or database right 2015</p>
</body>
</html>

