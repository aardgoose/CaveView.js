<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb" dir="ltr">
<head>
	<title>demo 3d cave viewer</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link type="text/css" href="/CaveView.js/build/CaveView/css/caveview.css" rel="stylesheet"/>
	<style>

		h1, h2, p {
			margin-left: 50px;
		}

		div#scene {
			position: relative;
			width: 600px;
			height:600px;
			margin-left: 100px;	
		}

		div#scene-caption {
			position: absolute;
			top: 8px;
			left: 100px;
			color: white;
			background-color: black;
		}

		div#info {
			position: absolute;
			left: 600px;
			width: 300px;
		}

		div#info * {
			margin-left: 20px;
		}

	</style>
</head>
<body onload="onload();" >
<script type="text/javascript" src="build/CaveView/lib/three.js" ></script>
<script type="text/javascript" src="build/CaveView/lib/Detector.js"></script>
<script type="text/javascript" src="build/CaveView/lib/OrbitControls.js" ></script>
<script type="text/javascript" src="build/CaveView/js/CaveView.js" ></script>
<script type="text/javascript" >
"use strict";

var	caveLoader = new CV.Loader( caveLoaded, progress );
var	viewState;
var viewControls;
var captionDiv;
var cave;
var index = 0;
var demoRunning = false;

var demo = [
	{
		caption: "A web cave survey viewer...",
		delay: 5,
		view: {
			zScale: 0.5
		}
	},
	{
		caption: "Displays center lines ...",
		delay: 7,
		view: {
			view: CV.VIEW_ELEVATION_S
		},
	},
	{
		caption: "splay legs ...",
		delay: 3,
		view: {
			splays: true
		}
	},
	{
		caption: "passage walls ...",
		delay: 2,
		view: {
			splays: false,
			walls: true
		}
	},
	{
		caption: "...",
		delay: 2,
		controls: {
			autoRotate: true,
			autoRotateRate: 2.0
		}
	},
	{
		caption: "Supports multiple cave shading modes ...",
		delay: 5,
		view: {
			shadingMode: CV.SHADING_SINGLE
		}
	},
	{
		caption: "by height ...",
		delay: 5,
		view: {
			shadingMode: CV.SHADING_HEIGHT
		}
	},
	{
		caption: "leg length ...",
		delay: 5,
		view: {
			shadingMode: CV.SHADING_LENGTH
		}
	},
	{
		caption: "leg inclination ...",
		delay: 5,
		view: {
			shadingMode : CV.SHADING_INCLINATION
		}
	},
	{
		caption: "survey section ...",
		delay: 5,
		view: {
			shadingMode: CV.SHADING_SURVEY
		}
	},
	{
		caption: "and depth below surface",
		delay: 5,
		view: {
			shadingMode: CV.SHADING_DEPTH
		}
	},
	{
		caption: "Entrance markers",
		delay: 5,
		view: {
			entrances: true
		}
	},
	{
		caption: "Terrain (tiled at multiple resolutions)",
		delay: 5,
		view: {
			terrainOpacity: 1,
			terrain: true,
			view: CV.VIEW_PLAN
		}
	},
	{
		caption: "Adjustable terrain transparency",
		delay: 5,
		view: {
			terrainOpacity: 0.4,
			view: CV.VIEW_ELEVATION_S
		}
	},
	{
		caption: "On screen indicators",
		delay: 5,
		view: {
			HUD: true
		}
	},
	{
		caption: "Optional bounding box",
		delay: 5,
		view: {
			box: true,
		}
	},
	{
		caption: "Vertical scaling from x 0.25",
		delay: 5,
		view: {
			zScale: 0
		}
	},
	{
		caption: "... to x 4",
		delay: 5,
		view: {
			zScale: 1.0,
			terrainOpacity: 1,
			terrain: false
		}
	},
	{
		caption: "Focus on selected survey sections",
		delay: 5,
		view: {
			zScale: 0.5,
			section: 3,
			box: false
		}
	},
	{
		caption: "limit view to selected section",
		delay: 5,
		view: {
			box: false,
			cut: true,
			walls: true,
			shadingMode: CV.SHADING_HEIGHT,
			view: CV.VIEW_ELEVATION_S
		}
	},
	{
		caption: "Orthographic view",
		delay: 5,
		view: {
			section: 3,
			cameraType: CV.CAMERA_ORTHOGRAPHIC,
			view: CV.VIEW_ELEVATION_S
		}
	},
	{
		caption: "...",
		delay: 5,
		view: {
			section: 0,
			entrances: false,
			cameraType: CV.CAMERA_PERSPECTIVE,
			box: false,
			shadingMode: CV.SHADING_SINGLE,
			walls: false,
			HUD: false
		},
		controls: {
			autoRotate: false
		}
	},
];

function runDemo() {

	if ( index === demo.length ) {

		index = 0;

		CV.Viewer.clearView();
		caveLoaded( cave );
		return;

	}

	var d = demo[index++];
	var p;

	captionDiv.textContent = d.caption;

	var view     = d.view;
	var controls = d.controls;

	if ( view ) for ( p in view ) viewState[p] = view[p];
	if ( controls ) for ( p in controls ) viewControls[p] = controls[p];

	setTimeout(runDemo, d.delay * 1000 );

}

function progress ( pcent ) {

	captionDiv.textContent = "Loading ... [ " +  pcent + "%";

}

function caveLoaded ( newCave ) {

	cave = newCave;

	if ( !demoRunning ) {

		viewState = CV.Viewer.getState;
		viewState.addEventListener( "newCave", viewComplete );

	}

	CV.Viewer.loadCave( cave );

}

function viewComplete () {

	if ( index ) return; // view complete called on cut operation.

	// display shading mode and initialize

	viewState.shadingMode = CV.SHADING_SINGLE;

	viewState.entrances  = false;
	viewState.box        = false;
	viewState.HUD        = false;
	viewState.walls      = false;

	viewControls = CV.Viewer.getControls();

	demoRunning = true;
	runDemo();

}

function onload () {

	if ( ! Detector.webgl ) {

		Detector.addGetWebGLMessage( { parent: document.getElementById( "scene" ) } );
		return;

	}

	CV.setEnvironment( { terrainDirectory: "/CaveView.js/build/terrain/", surveyDirectory: "/CaveView.js/build/surveys/" } );

	CV.Viewer.init( "scene" );
	CV.Hud.init( "scene" );

	CV.Viewer.clearView();

	caveLoader.loadURL( "P8_Master.3d" );
	
	captionDiv = document.getElementById( "scene-caption" );

}

</script>
<h1>Cave View</h1>
<h2>a 3D cave survey viewer for the web.</h2>
<div id="scene" >
<div id="info" >
<p>Displays:</p>
<ul><li><a href="http://survex.com/" >Survex</a> .3d</li><li><a href="http://therion.speleo.sk/" >Therion</a> .lox models</li></ul>
<p>Tested with the following browsers:</p>
<ul>
<li>Google Chrome 51</li>
<li>Firefox 47</li>
<li>Internet Explorer 11</li>
<li>Microsoft Edge (latest version)</li>
<li>Opera 38</li>
<li>Safari 9.1 (on iOS and OS X)</li>
</ul>
<p>No plugins required.</p>
</div>
<div id="scene-caption" ></div>
</div>

<p>contains DTM data &copy; Environment Agency copyright and/or database right 2015</p>
</body>
</html>

